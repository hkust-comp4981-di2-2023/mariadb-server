--source include/not_embedded.inc

if (!$SQL_ERRLOG_SO) {
  skip No SQL_ERROR_LOG plugin;
}

show variables like 'sql_error_log%';
set global sql_error_log_rate=1;
--error ER_NO_SUCH_TABLE
select * from t_doesnt_exist;

let $MYSQLD_DATADIR= `SELECT @@datadir`;
let grep_file=$MYSQLD_DATADIR/sql_errors.log;
let grep_regex=t_doesnt_exist;
replace_regex /[1-9]* test [1-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9] [ 0-9][0-9]:[0-9][0-9]:[0-9][0-9] [^E]*/THREAD_ID DATABASE_NAME TIME HOSTNAME /;
source include/grep.inc;

remove_file $MYSQLD_DATADIR/sql_errors.log;
